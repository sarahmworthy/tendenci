{% extends form_template %}
{% load styled_forms %}
{% load forms_tags %}

{% block title %}{{ form.title }}{% endblock %}
{% block meta_description %}{{ form.intro }}{% endblock %}

{% block extra_head %}
{{ block.super }}
<link rel="stylesheet" href="{{ STATIC_URL }}css/forms.css">

{% endblock extra_head %}

{% block body %}

<div class="t">
    {% if request.user.is_authenticated %}
        {% forms_nav request.user form %}
    {% endif %}
    
    <div class="form-wrap">
        <h1>{{ form.title }}</h1>
        {% with form.intro_position as intro_pos and form.fields_position as fields_pos and form.pricing_position as pricing_pos %}
        {% if intro_pos < fields_pos and intro_pos < pricing_pos %}
        {% if form.intro %}
        <h2>{{ form.intro_name }}</h2>
        <div>{{ form.intro|safe|urlize }}</div>
        {% endif %}
        {% endif %}
        {% endwith %}

    	<div class="form-builder-wrap">
        	<form method="post" enctype="multipart/form-data">{% csrf_token %}
            <div style="display:none">
                <input type="hidden" name="entry_path" value="{{ request.path }}">
            </div>
        	<div class="forms">
                {{ form_for_form|styled_form }}
            	<input type="submit" value="Submit" />
    		</div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_body %}
    {{ block.super }}
    <script type="text/javascript" src="{{ STATIC_URL }}js/email-verification.js"></script>
    <script type="text/javascript">
		$(document).ready(function(){
			$('.custom-price').closest('label').attr('for', '');

            {% with form.intro_position as intro_pos and form.fields_position as fields_pos and form.pricing_position as pricing_pos %}
                var introDiv = $("<div>{{ form.intro|safe|urlize }}</div>");
                {% if intro_pos > pricing_pos and intro_pos > fields_pos%}
                    {% if pricing_pos > fields_pos %}
                        introDiv.insertAfter($('.payment-field:last').parents('.form-field'));
                    {% else %}
                        introDiv.insertAfter($('.t .forms .formforform-field:last').parents('.form-field'));
                    {% endif %}
                {% elif intro_pos > pricing_pos and intro_pos < fields_pos %}
                    introDiv.insertAfter($('.payment-field:last').parents('.form-field'));
                {% elif intro_pos > fields_pos and intro_pos < pricing_pos %}
                    introDiv.insertAfter($('.t .forms .formforform-field:last').parents('.form-field'));
                {% endif %}
            {% endwith %}

            var introName = $("<h2>{{ form.intro_name }}</h2>");
            var fieldsName = $("<h2>{{ form.fields_name }}</h2>");
            var pricingName = $("<h2>{{ form.pricing_name }}</h2>");

            introName.insertBefore(introDiv);
            var fieldsOption = $('.formforform-field:first');
            fieldsName.insertBefore(fieldsOption.parents('.form-field'));
            var pricingOption = $('label[for="id_pricing_option_0"]:first');
            pricingOption.text('');
            pricingName.insertBefore(pricingOption.parents('.form-field'));
		});
    </script>
{% endblock %}
